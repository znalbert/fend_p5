var Event=function(e){this.title=ko.observable(e.title),this.venue=ko.observable(e.venue_name),this.url=ko.observable(e.url),this.venue_url=ko.observable(e.venue_url),this.venue_address=ko.observable(e.venue_address),this.city_name=ko.observable(e.city_name),this.state=ko.observable(e.region_name),this.lat=ko.observable(e.latitude),this.lng=ko.observable(e.longitude),this.category=ko.observable(e.categories.category.id)},ViewModel=function(){function e(){s=new google.maps.Map(document.getElementById("map"),{center:l,zoom:13,disableDefaultUI:!0})}function o(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(o){l.lat=o.coords.latitude,l.lng=o.coords.longitude,e(),n(1)})}function t(){var o="https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyAZKV6_aryLoI5q40ikKRJ_Qy-32Hg-3ng&address=",t=$("#city").val(),a=o+t;i.eventList([]),console.log(t),console.log(a),$.getJSON(a,function(o){pos=o.results[0].geometry.location,l.lat=pos.lat,l.lng=pos.lng,e(),n(1)})}function n(e){var o="https://api.eventful.com/json/events/search?app_key=",t="VN3TDSXzQdSQK2rD",n="&date=Today&sort_order=popularity&within=20",i="&include=categories,popularity",s="&location="+l.lat+","+l.lng,r="&page_number="+e,u=o+t+n+i+r+s;$.ajax({url:u,dataType:"jsonp",success:function(e){console.log(e),e.events.event.forEach(a)}})}function a(e,o,t){i.eventList.push(new Event(e)),console.log(e.venue_name+", "+e.title);var n={lat:Number(e.latitude),lng:Number(e.longitude)};console.log(n),marker=new google.maps.Marker({position:n,map:s,animation:google.maps.Animation.DROP}),marker.setMap(s)}var i=this;this.eventList=ko.observableArray([]);var s,l={};o(),document.getElementById("submit-city").addEventListener("click",function(){t()})};ko.applyBindings(new ViewModel);