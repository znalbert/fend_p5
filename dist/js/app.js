var Event=function(e){this.title=ko.observable(e.title),this.venue=ko.observable(e.venue_name),this.url=ko.observable(e.url),this.venue_url=ko.observable(e.venue_url),this.venue_address=ko.observable(e.venue_address),this.city_name=ko.observable(e.city_name),this.state=ko.observable(e.region_name),this.lat=ko.observable(e.latitude),this.lng=ko.observable(e.longitude),this.category=ko.observable(e.categories.category[0].id)},ViewModel=function(){var e=this;e.eventList=ko.observableArray([]),e.coords={},e.map=function(){map=new google.maps.Map(document.getElementById("map"),{center:e.coords,zoom:10,disableDefaultUI:!0})},e.getGeoLocation=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(o){e.coords.lat=o.coords.latitude,e.coords.lng=o.coords.longitude,e.map(),e.getEvents(1)})},e.getLocationManually=function(){var o="https://maps.googleapis.com/maps/api/geocode/json?",t="key=AIzaSyAZKV6_aryLoI5q40ikKRJ_Qy-32Hg-3ng&address=",n=$("#city").val(),a=o+t+n;e.eventList([]),console.log(city),console.log(a),$.getJSON(a,function(o){pos=o.results[0].geometry.location,e.coords.lat=pos.lat,e.coords.lng=pos.lng,e.map(),e.getEvents(1)})},e.getEvents=function(o){var t="https://api.eventful.com/json/events/search?app_key=",n="VN3TDSXzQdSQK2rD",a="&date=Today&sort_order=popularity&within=20",s="&include=categories,popularity",i="&location="+e.coords.lat+","+e.coords.lng,l="&page_number="+o,r=t+n+a+s+l+i;console.log(r),$.ajax({url:r,dataType:"jsonp",success:function(o){console.log(o),o.events.event.forEach(e.eventViews)}})},e.eventViews=function(o,t,n){e.eventList.push(new Event(o)),console.log(e.eventList());var a={lat:Number(o.latitude),lng:Number(o.longitude)};console.log(a),marker=new google.maps.Marker({position:a,map:map,animation:google.maps.Animation.DROP}),marker.setMap(map)},document.getElementById("submit-city").addEventListener("click",function(){e.getLocationManually()}),e.getGeoLocation()};ko.applyBindings(new ViewModel);